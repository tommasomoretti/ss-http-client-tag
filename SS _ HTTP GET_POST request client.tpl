___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "SS | HTTP GET/POST request client",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Collect data from HTTP POST or GET requests.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "basic_settings",
    "displayName": "Basic settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "custom_endpoint",
        "displayName": "Endpoint",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "valueHint": "(not set)",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Lorem ipsum"
      },
      {
        "type": "RADIO",
        "name": "request_method",
        "displayName": "Accepted request method",
        "radioItems": [
          {
            "value": "GET",
            "displayValue": "GET",
            "help": "Lorem ipsum"
          },
          {
            "value": "POST",
            "displayValue": "POST",
            "help": "Lorem ipsum"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "RADIO",
        "name": "accept_requests_from",
        "displayName": "Accept requests from",
        "radioItems": [
          {
            "value": "any",
            "displayValue": "Any domains",
            "help": "Lorem ipsum"
          },
          {
            "value": "some",
            "displayValue": "Some domains",
            "help": "Lorem ipsum"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "allowed_domains_list",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Allowed domains",
            "name": "allowed_domain",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "https://domain.com"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "accept_requests_from",
            "paramValue": "some",
            "type": "EQUALS"
          }
        ],
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "help": "Lorem ipsum"
  },
  {
    "type": "GROUP",
    "name": "export_log_options",
    "displayName": "Export log options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "log_requests_to_bq",
        "checkboxText": "Export logs to Google BigQuery",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "displayName": "Enable export",
        "help": "Lorem ipsum"
      },
      {
        "type": "TEXT",
        "name": "project_id",
        "displayName": "Project ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "Set to the Google Cloud Project ID where the Google BigQuery is located. If the project is the same as the one running the Server container, you can leave this field empty.",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "log_requests_to_bq",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "dataset_id",
        "displayName": "Dataset ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "Set to the Dataset ID of the BigQuery table.",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "log_requests_to_bq",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "table_id",
        "displayName": "Table ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "The table ID",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "log_requests_to_bq",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "debug_options",
    "displayName": "Debug options",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "enable_logs",
        "checkboxText": "Set enableLogs",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "displayName": "Enable logs",
        "help": "If it set to true, then enable logging on GTM debug console and. Google Cloud Logs Explorer (run the query logName \u003d~ \"stdout\" to see log entries created by this API.).",
        "defaultValue": false
      }
    ],
    "help": "Lorem ipsum"
  }
]


___SANDBOXED_JS_FOR_SERVER___

const claimRequest = require('claimRequest');
const getRequestHeader = require('getRequestHeader');
const getRequestBody = require('getRequestBody');
const getRequestMethod = require('getRequestMethod');
const getRequestPath = require('getRequestPath');
const setResponseHeader = require('setResponseHeader');
const setResponseBody = require('setResponseBody');
const setResponseStatus = require('setResponseStatus');
const returnResponse = require('returnResponse');
const setPixelResponse = require('setPixelResponse');
const runContainer = require('runContainer');
const log = require('logToConsole');
const JSON = require('JSON');
const decodeUriComponent = require('decodeUriComponent');
const getRequestQueryString = require('getRequestQueryString');
const Object = require('Object');
const getRequestQueryParameters = require('getRequestQueryParameters');
const BigQuery = require('BigQuery');
const getTimestampMillis = require('getTimestampMillis');
const getType = require('getType');


const endpoint = data.custom_endpoint;
const request_method = getRequestMethod();
const allowed_request_method = data.request_method;

// BigQuery project settings

const project = {
  projectId: data.project_id,
  datasetId: data.dataset_id,
  tableId: data.table_id
};


// Claim the request
if(getRequestPath() === '/' + endpoint){
  const allow_request_from = data.accept_requests_from;
  const origin = getRequestHeader('Origin');

  if(request_method === allowed_request_method){
    // POST requests
    if (request_method === 'POST') {
      if(data.enable_logs){log('SERVER-SIDE GTM CLIENT TAG: TAG CONFIGURATION');}
      if(data.enable_logs){log('👉 Endpoint:', endpoint);}
      if(data.enable_logs){log('👉 Accepted request type:', data.request_method);}
      if(data.enable_logs){log('👉 Accept data from:', data.accept_requests_from + ' domains');} 
      if(data.enable_logs){log('REQUEST DATA');}
      if(data.enable_logs){log('👍 POST request');}
      
      // Any domains
      if (allow_request_from === 'any') {
        if(data.enable_logs){log('👍 Request origin:', origin);}
        if(data.enable_logs){log('👍 Request origin allowed');}
        const event_data = JSON.parse(getRequestBody());
        if(data.enable_logs){log('👍 Event data: ', event_data);}
        claim_request(event_data, origin); 
        
      // Some domains
      } else {
        const allowed_domains_list = data.allowed_domains_list;

        for (var i=0; i < allowed_domains_list.length; i++){ 
          if (allowed_domains_list[i].allowed_domain === origin) {
            if(data.enable_logs){log('👉 Request origin:', origin);}
            if(data.enable_logs){log('👍 Request origin allowed');}
            const event_data = JSON.parse(getRequestBody());
            if(data.enable_logs){log('👍 Event data: ', event_data);}
            claim_request(event_data, origin);
          }
        }
      }   
      
    // GET requests       
    } else if (request_method === 'GET') {
      if(data.enable_logs){log('SERVER-SIDE GTM CLIENT TAG: TAG CONFIGURATION');}
      if(data.enable_logs){log('👉 Endpoint:', endpoint);}
      if(data.enable_logs){log('👉 Accepted request type:', data.request_method);}
      if(data.enable_logs){log('👉 Accept data from:', data.accept_requests_from + ' domains');} 
      if(data.enable_logs){log('REQUEST DATA');}
      if(data.enable_logs){log('👍 GET request');}
      
      // Any domains
      if (allow_request_from === 'any') {
        if(data.enable_logs){log('👉 Request origin:', origin);}
        if(data.enable_logs){log('👍 Request origin allowed');}   
        const event_data = getRequestQueryParameters();
                 
        Object.keys(event_data).forEach(function(key) {
          // const type = getType(event_data[key]);
          // log(event_data[key]);
          // log(type);
          // if (type === 'object'){
          //   event_data[key] = JSON.parse(event_data[key]);
          // }
        });
        
        if(data.enable_logs){log('👍 Event data: ', event_data);}
        claim_request(event_data, origin); 
        
      // Some domains
      } else {
        const allowed_domains_list = data.allowed_domains_list;

        for (let i=0; i < allowed_domains_list.length; i++){ 
          if (allowed_domains_list[i].allowed_domain === origin) {
            if(data.enable_logs){log('👉 Request origin:', origin);}
            if(data.enable_logs){log('👍 Request origin allowed');}
            const event_data = getRequestQueryParameters();
            
            Object.keys(event_data).forEach(function(key) {
              // const type = getType(event_data[key]);
              // log(event_data[key]);
              // log(type);
              // if (type === 'object'){
              //   event_data[key] = JSON.parse(event_data[key]);
              // }
            });
            
            if(data.enable_logs){log('👍 Event data: ', event_data);}
            claim_request(event_data, origin); 
          }
        }
      }
    }
  } else {
    if(data.enable_logs){log('🔴 401 Unauthorized request. This is not a POST or a GET request 🖕');}
    setResponseStatus(401);
    returnResponse();
  }
}


// Claim requests
function claim_request(event_data, allowed_origin) {
  claimRequest();
  runContainer(event_data, () => {
    setResponseStatus(200);
    setResponseHeader('Access-Control-Allow-Headers', 'content-type');
    setResponseHeader('Access-Control-Allow-Credentials', 'true');
    setResponseHeader('Access-Control-Allow-Origin', allowed_origin);
    setResponseHeader('Access-Control-Allow-Methods', allowed_request_method);
    setResponseHeader('cache-control', 'no-cache');
    setResponseBody(JSON.stringify(event_data));
    returnResponse();
  });
  
  // Log incoming request to BQ 
  if(data.log_requests_to_bq){
    const log_data = {
      timestamp: getTimestampMillis() / 1000,
      method: request_method,
      host: getRequestHeader('Host'),
      origin: getRequestHeader('Origin'),
      referer: getRequestHeader('Referer'),
      content_length: getRequestHeader('Content-Length'),
      content_type: getRequestHeader('Content-Type'),
      user_agent: getRequestHeader('User-Agent'),
      browser_info: getRequestHeader('Sec-Ch-Ua'),
      device: getRequestHeader('Sec-Ch-Ua-Mobile'),      
      platform: getRequestHeader('Sec-Ch-Ua-Platform'),
      city: getRequestHeader('X-Appengine-City'),
      user_ip: getRequestHeader('X-Appengine-User-Ip'),
      payload: JSON.stringify(event_data)
    };
    sendToBigQuery(project, [log_data]);
  }
  if(data.enable_logs){log('🟢 200 Ok: Request claimed succesfully');}
}


// Send data to BigQuery
function sendToBigQuery(project, rows){
  BigQuery.insert(
    project,
    rows,
    {
      'ignoreUnknownValues': true,
      'skipInvalidRows': false
    },
    () => {
      if(data.enable_logs){log('🟢 Request logged successfully to ' +  project.tableId);}
    },
    () => {
      if(data.enable_logs){log('🔴 Request not logged to ' + project.tableI);}
    }
  );
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "run_container",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_bigquery",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedTables",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "projectId"
                  },
                  {
                    "type": 1,
                    "string": "datasetId"
                  },
                  {
                    "type": 1,
                    "string": "tableId"
                  },
                  {
                    "type": 1,
                    "string": "operation"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 25/3/2022, 20:50:55


